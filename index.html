<!DOCTYPE html>
<html>

<head>
    <title>Encryption</title>
    <style>
        body {
            font-family: cursive;
            background-color: #e8d6bb;
            padding: 20px;
        }

        label {
            font-weight: bold;
        }

        input[type="password"],
        textarea {
            padding: 5px;
            font-family: cursive;
            font-size: 16px;
            border: none;
            background-color: #f7e5d6;
            border-radius: 5px;
            resize: none;
        }

        textarea {
            height: 150px;
            width: 300px;
        }

        button {
            margin-top: 10px;
            padding: 5px 10px;
            font-size: 16px;
            font-family: cursive;
            border: none;
            background-color: #d6bba1;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
        }

        #output {
            margin-top: 10px;
            padding: 5px;
            font-family: cursive;
            font-size: 16px;
            border: none;
            background-color: #f7e5d6;
            border-radius: 5px;
            resize: vertical;
        }
    </style>
    <script>
        function preprocessText(input) {
            const cleanedInput = input.replace(/\s+/g, '_');
            const cleanedUppercaseInput = cleanedInput.toUpperCase().replace(/[^A-Z0-9_!?.,-]/g, '');
            return cleanedUppercaseInput;
        }

        function encryptCharacter(char, passwordChar, alphabet) {
            const charIndex = alphabet.indexOf(char);
            const passwordIndex = alphabet.indexOf(passwordChar);
            const encryptedIndex = (charIndex + passwordIndex) % alphabet.length;
            return alphabet[encryptedIndex];
        }

        function encrypt(text, password, alphabet) {
            const cleanedText = preprocessText(text);
            const cleanedPassword = preprocessText(password);

            let encryptedText = '';

            for (let i = 0; i < cleanedText.length; i++) {
                const char = cleanedText[i];
                const passwordChar = cleanedPassword[i % cleanedPassword.length];
                const encryptedChar = encryptCharacter(char, passwordChar, alphabet);
                encryptedText += encryptedChar;
            }

            return encryptedText;
        }

        function decryptCharacter(char, passwordChar, alphabet) {
            const charIndex = alphabet.indexOf(char);
            const passwordIndex = alphabet.indexOf(passwordChar);
            const decryptedIndex = (charIndex - passwordIndex + alphabet.length) % alphabet.length;
            return alphabet[decryptedIndex];
        }

        function decrypt(text, password, alphabet) {
            const cleanedText = preprocessText(text);
            const cleanedPassword = preprocessText(password);

            let decryptedText = '';

            for (let i = 0; i < cleanedText.length; i++) {
                const char = cleanedText[i];
                const passwordChar = cleanedPassword[i % cleanedPassword.length];
                const decryptedChar = decryptCharacter(char, passwordChar, alphabet);
                decryptedText += decryptedChar;
            }

            return decryptedText;
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function rotateLetter(currentLetter, alphabet) {
            const currentIndex = alphabet.indexOf(currentLetter);
            const nextIndex = (currentIndex + 1) % alphabet.length;
            return alphabet[nextIndex];
        }

        async function displayResult(alphabet, text, outputTextArea) {

            let currentText = '';

            for (let i = 0; i < text.length; i++) {
                const correctLetter = text[i];
                let currentLetter = 'A';
                currentText += currentLetter;
                outputTextArea.value = currentText;

                let nextLetter = currentLetter;

                while (nextLetter !== correctLetter) {
                    nextLetter = rotateLetter(nextLetter, alphabet);
                    currentText = currentText.slice(0, -1) + nextLetter;
                    outputTextArea.value = currentText;
                    await delay(50);
                }

                await delay(150);
            }
        }

        function encryptAndDisplayResult() {
            const passwordInput = document.getElementById('heslo');
            const textInput = document.getElementById('text');

            const password = preprocessText(passwordInput.value);
            const text = preprocessText(textInput.value);

            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_!?.,-";
            const encryptedText = encrypt(text, password, alphabet);

            const outputTextArea = document.getElementById('output');
            displayResult(alphabet, encryptedText, outputTextArea);
        }

        function decryptAndDisplayResult() {
            const passwordInput = document.getElementById('heslo');
            const textInput = document.getElementById('text');

            const password = preprocessText(passwordInput.value);
            const text = preprocessText(textInput.value);

            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_!?.,-";
            const decryptedText = decrypt(text, password, alphabet);
            const outputTextArea = document.getElementById('output');
            displayResult(alphabet, decryptedText, outputTextArea);
            // Replace underscores with spaces
            const finalText = decryptedText.replace(/_/g, ' ');
            outputTextArea.value = finalText;
        }
    </script>
</head>

<body>
    <div class="container">
        <label for="heslo">Heslo:</label>
        <input type="password" id="heslo" />
        <br />
        <label for="text">Text:</label>
        <br />
        <textarea id="text" rows="10" cols="50"></textarea>
        <br />
        <button onclick="encryptAndDisplayResult()">Sifruj</button>
        <button onclick="decryptAndDisplayResult()">Desifruj</button>
        <br />
        <textarea id="output" rows="10" cols="50" readonly></textarea>
    </div>
</body>

</html>